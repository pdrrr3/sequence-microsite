import React, { createRef, useEffect, useState } from "react"
import throttle from "lodash.throttle"

export const AnimatedBoxes = () => {
  const [isVisible, currentElement] = useVisibility(0)
  const [state, setState] = useState({
    playing: true,
    reversed: false,
    hovered: false,
    hasPlayed: false,
  })

  useEffect(() => {
    const animated = document.querySelector(".animated-boxes .box-sequence")
    animated.addEventListener("animationiteration", () => {
      setState(s => ({
        ...s,
        playing: !s.hovered && s.reversed,
        reversed: !s.reversed,
        hasPlayed: true,
      }))
    })
  }, [])

  return (
    <div
      ref={currentElement}
      role="presentation"
      className={`animated-boxes ${state.hasPlayed ? "animate-out" : ""}  ${
        state.playing && isVisible ? "active" : ""
      }`}
      onMouseEnter={() =>
        setState(s => ({ ...s, hovered: true, playing: true }))
      }
      onMouseLeave={() =>
        setState(s => ({ ...s, hovered: false, playing: true }))
      }
      onClick={() => setState(s => ({ ...s, playing: true }))}
    >
      <EthBox />
      <SdkBox />
      <WalletBox />
      <SequenceBox />
    </div>
  )
}

function useVisibility() {
  const [isVisible, setIsVisible] = useState(false)
  const currentElement = createRef()

  const onScroll = throttle(() => {
    if (!currentElement.current) {
      setIsVisible(false)
      return
    }
    const top = currentElement.current.getBoundingClientRect().top
    setIsVisible(top <= window.innerHeight - 400)
  }, 100)

  useEffect(() => {
    window.addEventListener("scroll", onScroll)
    return () => window.removeEventListener("scroll", onScroll)
  })

  return [isVisible, currentElement]
}

export const EthBox = () => (
  <svg
    className="box box-eth"
    width="602"
    height="397"
    viewBox="0 0 602 397"
    fill="none"
    xmlns="http://www.w3.org/2000/svg"
  >
    <path d="M220 365V245L36 139V259L220 365Z" fill="#2B1767" />
    <path d="M220 365V245L404 139V259L220 365Z" fill="#513A98" />
    <path d="M220 245L36 139L220 32L404 139L220 245Z" fill="#3F2B7C" />
    <path
      className="box-text"
      d="M484.422 208H496.709V204.831H488.266V200.489H496.043V197.32H488.266V192.988H496.673V189.818H484.422V208ZM506.912 194.364H504.346V191.097H500.564V194.364H498.7V197.205H500.564V204.307C500.546 206.979 502.366 208.302 505.11 208.186C506.086 208.151 506.779 207.956 507.16 207.831L506.566 205.017C506.379 205.053 505.98 205.141 505.625 205.141C504.87 205.141 504.346 204.857 504.346 203.81V197.205H506.912V194.364ZM513.45 200.116C513.459 198.359 514.533 197.329 516.078 197.329C517.614 197.329 518.52 198.314 518.511 199.992V208H522.293V199.317C522.302 196.121 520.419 194.186 517.579 194.186C515.51 194.186 514.125 195.163 513.504 196.77H513.344V189.818H509.668V208H513.45V200.116ZM531.483 208.266C534.857 208.266 537.13 206.624 537.662 204.094L534.165 203.863C533.783 204.902 532.806 205.443 531.546 205.443C529.655 205.443 528.456 204.191 528.456 202.158V202.15H537.742V201.111C537.742 196.477 534.937 194.186 531.333 194.186C527.32 194.186 524.719 197.036 524.719 201.244C524.719 205.567 527.284 208.266 531.483 208.266ZM528.456 199.806C528.536 198.252 529.717 197.009 531.395 197.009C533.037 197.009 534.173 198.181 534.182 199.806H528.456ZM540.21 208H543.992V200.285C543.992 198.607 545.218 197.453 546.887 197.453C547.41 197.453 548.129 197.542 548.485 197.657V194.301C548.147 194.222 547.677 194.168 547.295 194.168C545.768 194.168 544.516 195.056 544.019 196.743H543.877V194.364H540.21V208ZM556.02 208.266C559.393 208.266 561.666 206.624 562.199 204.094L558.701 203.863C558.319 204.902 557.342 205.443 556.082 205.443C554.191 205.443 552.992 204.191 552.992 202.158V202.15H562.278V201.111C562.278 196.477 559.473 194.186 555.869 194.186C551.856 194.186 549.255 197.036 549.255 201.244C549.255 205.567 551.82 208.266 556.02 208.266ZM552.992 199.806C553.072 198.252 554.253 197.009 555.931 197.009C557.573 197.009 558.71 198.181 558.718 199.806H552.992ZM573.491 202.194C573.5 204.023 572.248 204.982 570.89 204.982C569.461 204.982 568.537 203.978 568.528 202.371V194.364H564.747V203.046C564.755 206.233 566.62 208.178 569.363 208.178C571.414 208.178 572.888 207.121 573.5 205.523H573.642V208H577.273V194.364H573.491V202.194ZM580.298 208H584.08V199.815C584.08 198.305 585.039 197.302 586.3 197.302C587.543 197.302 588.377 198.154 588.377 199.495V208H592.044V199.673C592.044 198.261 592.852 197.302 594.228 197.302C595.435 197.302 596.341 198.057 596.341 199.575V208H600.114V198.829C600.114 195.873 598.356 194.186 595.817 194.186C593.819 194.186 592.266 195.207 591.706 196.77H591.564C591.129 195.189 589.735 194.186 587.862 194.186C586.025 194.186 584.631 195.163 584.062 196.77H583.903V194.364H580.298V208Z"
      fill="#513A98"
    />
  </svg>
)

export const SdkBox = () => (
  <svg
    className="box box-sdk"
    width="602"
    height="397"
    viewBox="0 0 602 397"
    fill="none"
    xmlns="http://www.w3.org/2000/svg"
  >
    <path
      className="box-text"
      d="M493.54 195.047H497.225C497.171 191.807 494.508 189.57 490.46 189.57C486.473 189.57 483.553 191.771 483.57 195.074C483.562 197.755 485.453 199.291 488.524 200.028L490.504 200.525C492.484 201.004 493.585 201.572 493.593 202.798C493.585 204.129 492.324 205.035 490.371 205.035C488.373 205.035 486.935 204.112 486.811 202.292H483.091C483.189 206.224 486.003 208.257 490.415 208.257C494.854 208.257 497.464 206.136 497.473 202.806C497.464 199.779 495.183 198.172 492.022 197.462L490.389 197.071C488.808 196.707 487.486 196.121 487.512 194.816C487.512 193.645 488.551 192.783 490.433 192.783C492.271 192.783 493.398 193.618 493.54 195.047ZM506.504 208C512.044 208 515.4 204.573 515.4 198.891C515.4 193.227 512.044 189.818 506.557 189.818H500.059V208H506.504ZM503.903 204.706V193.112H506.353C509.762 193.112 511.564 194.852 511.564 198.891C511.564 202.949 509.762 204.706 506.344 204.706H503.903ZM518.247 208H522.091V202.833L523.982 200.525L528.963 208H533.562L526.734 197.959L533.482 189.818H528.874L522.331 197.835H522.091V189.818H518.247V208Z"
      fill="#526EC1"
    />
    <path
      d="M219.892 384V251.027L16 133.567V266.54L219.892 384Z"
      fill="#1E3C60"
      opacity="0.75"
    />
    <path
      d="M219.893 384V251.027L423.785 133.567V266.54L219.893 384Z"
      fill="#436896"
      opacity="0.75"
    />
    <path
      d="M219.892 251.027L16 133.568L219.892 15L423.784 133.568L219.892 251.027Z"
      fill="#2E5686"
      opacity="0.75"
    />
  </svg>
)

export const WalletBox = () => (
  <svg
    className="box box-wallet"
    width="602"
    height="397"
    viewBox="0 0 602 397"
    fill="none"
    xmlns="http://www.w3.org/2000/svg"
  >
    <g clipPath="url(#clip0)">
      <path
        className="box-text"
        d="M488.062 207H491.809L495.262 195.113H495.404L498.866 207H502.613L507.815 188.818H503.616L500.606 201.478H500.447L497.135 188.818H493.54L490.219 201.451H490.068L487.059 188.818H482.86L488.062 207ZM512.225 207.257C514.241 207.257 515.546 206.379 516.212 205.109H516.318V207H519.905V197.803C519.905 194.553 517.153 193.186 514.116 193.186C510.849 193.186 508.701 194.749 508.177 197.234L511.675 197.518C511.932 196.613 512.74 195.947 514.099 195.947C515.386 195.947 516.123 196.595 516.123 197.714V197.767C516.123 198.646 515.191 198.761 512.82 198.992C510.121 199.241 507.698 200.146 507.698 203.191C507.698 205.89 509.624 207.257 512.225 207.257ZM513.308 204.647C512.145 204.647 511.311 204.106 511.311 203.067C511.311 202.002 512.19 201.478 513.522 201.292C514.347 201.176 515.697 200.981 516.149 200.679V202.126C516.149 203.555 514.969 204.647 513.308 204.647ZM526.621 188.818H522.839V207H526.621V188.818ZM533.432 188.818H529.65V207H533.432V188.818ZM542.676 207.266C546.05 207.266 548.323 205.624 548.855 203.094L545.357 202.863C544.976 203.902 543.999 204.443 542.739 204.443C540.848 204.443 539.649 203.191 539.649 201.158V201.15H548.935V200.111C548.935 195.477 546.13 193.186 542.525 193.186C538.513 193.186 535.911 196.036 535.911 200.244C535.911 204.567 538.477 207.266 542.676 207.266ZM539.649 198.806C539.729 197.252 540.91 196.009 542.588 196.009C544.23 196.009 545.366 197.181 545.375 198.806H539.649ZM558.656 193.364H556.091V190.097H552.309V193.364H550.444V196.205H552.309V203.307C552.291 205.979 554.111 207.302 556.854 207.186C557.831 207.151 558.523 206.956 558.905 206.831L558.31 204.017C558.124 204.053 557.724 204.141 557.369 204.141C556.615 204.141 556.091 203.857 556.091 202.81V196.205H558.656V193.364Z"
        fill="#9EABCE"
        opacity="0.75"
      />
      <path
        d="M219.893 397V253.937L0.529297 127.564V270.628L219.893 397Z"
        fill="#646464"
        opacity="0.75"
      />
      <path
        d="M219.894 397V253.937L439.258 127.564V270.628L219.894 397Z"
        fill="#8F9192"
        opacity="0.75"
      />
      <path
        d="M219.893 253.937L0.529297 127.565L219.893 0L439.256 127.565L219.893 253.937Z"
        fill="#7B7D7F"
        opacity="0.75"
      />
    </g>
    <defs>
      <clipPath id="clip0">
        <rect width="602" height="397" fill="white" />
      </clipPath>
    </defs>
  </svg>
)

export const SequenceBox = () => (
  <svg
    className="box box-sequence"
    width="602"
    height="397"
    viewBox="0 0 602 397"
    fill="none"
    xmlns="http://www.w3.org/2000/svg"
  >
    <path
      fillRule="evenodd"
      clipRule="evenodd"
      d="M0.000686646 269.861L0 269.861H0.000686646V127.029H220.023V269.861H220.022V396.891L0.000686646 269.861Z"
      fill="#050047"
    />
    <path
      fillRule="evenodd"
      clipRule="evenodd"
      d="M0.000686646 269.861L0 269.861H0.000686646V127.029H220.023V269.861H220.022V396.891L0.000686646 269.861Z"
      fill="url(#paint0_linear)"
      fillOpacity="0.7"
    />
    <path
      fillRule="evenodd"
      clipRule="evenodd"
      d="M0.000686646 269.861L0 269.861H0.000686646V127.029H220.023V269.861H220.022V396.891L0.000686646 269.861Z"
      fill="url(#paint1_linear)"
      fillOpacity="0.8"
    />
    <path
      fillRule="evenodd"
      clipRule="evenodd"
      d="M440.045 127.029V269.861H440.043L220.021 396.891V269.861H220.023V127.029H440.045Z"
      fill="#342ABC"
    />
    <path
      fillRule="evenodd"
      clipRule="evenodd"
      d="M440.045 127.029V269.861H440.043L220.021 396.891V269.861H220.023V127.029H440.045Z"
      fill="url(#paint2_linear)"
    />
    <path
      fillRule="evenodd"
      clipRule="evenodd"
      d="M440.045 127.029V269.861H440.043L220.021 396.891V269.861H220.023V127.029H440.045Z"
      fill="url(#paint3_linear)"
    />
    <path
      fillRule="evenodd"
      clipRule="evenodd"
      d="M440.045 127.029V269.861H440.043L220.021 396.891V269.861H220.023V127.029H440.045Z"
      fill="white"
      fillOpacity="0.1"
    />
    <path
      d="M0 127.029L220.022 0L440.044 127.029L220.022 254.059L0 127.029Z"
      fill="#231B8E"
    />
    <path
      d="M0 127.029L220.022 0L440.044 127.029L220.022 254.059L0 127.029Z"
      fill="url(#paint4_linear)"
      fillOpacity="0.7"
    />
    <path
      d="M0 127.029L220.022 0L440.044 127.029L220.022 254.059L0 127.029Z"
      fill="url(#paint5_linear)"
      fillOpacity="0.8"
    />
    <g>
      <path
        d="M485.802 185.933C487.901 185.933 489.604 184.254 489.604 182.183C489.604 180.112 487.901 178.433 485.802 178.433C483.703 178.43 482 180.109 482 182.18C482 184.254 483.703 185.933 485.802 185.933Z"
        fill="#3241B7"
      />
      <path
        d="M485.802 185.933C487.901 185.933 489.604 184.254 489.604 182.183C489.604 180.112 487.901 178.433 485.802 178.433C483.703 178.43 482 180.109 482 182.18C482 184.254 483.703 185.933 485.802 185.933Z"
        fill="url(#paint6_linear)"
      />
      <path
        d="M485.802 197.004H496.837C496.852 197.004 496.869 197.001 496.884 197.001C496.899 197.001 496.916 197.004 496.931 197.004C499.03 197.004 500.733 195.324 500.733 193.254C500.733 191.183 499.03 189.503 496.931 189.503C496.916 189.503 496.899 189.506 496.884 189.506C496.869 189.506 496.852 189.503 496.837 189.503H485.802C483.703 189.501 482 191.18 482 193.251C482 195.324 483.703 197.004 485.802 197.004Z"
        fill="#432AB7"
      />
      <path
        d="M485.802 197.004H496.837C496.852 197.004 496.869 197.001 496.884 197.001C496.899 197.001 496.916 197.004 496.931 197.004C499.03 197.004 500.733 195.324 500.733 193.254C500.733 191.183 499.03 189.503 496.931 189.503C496.916 189.503 496.899 189.506 496.884 189.506C496.869 189.506 496.852 189.503 496.837 189.503H485.802C483.703 189.501 482 191.18 482 193.251C482 195.324 483.703 197.004 485.802 197.004Z"
        fill="url(#paint7_linear)"
      />
      <path
        d="M485.802 211.643C483.703 211.643 482 213.323 482 215.393C482 217.464 483.703 219.144 485.802 219.144C487.901 219.144 489.604 217.464 489.604 215.393C489.604 213.323 487.904 211.643 485.802 211.643Z"
        fill="#7D32A3"
      />
      <path
        d="M485.802 211.643C483.703 211.643 482 213.323 482 215.393C482 217.464 483.703 219.144 485.802 219.144C487.901 219.144 489.604 217.464 489.604 215.393C489.604 213.323 487.904 211.643 485.802 211.643Z"
        fill="url(#paint8_linear)"
      />
      <path
        d="M496.935 174.861H508.067C510.166 174.861 511.869 173.182 511.869 171.111C511.869 169.038 510.166 167.358 508.067 167.358H496.935C494.836 167.358 493.133 169.038 493.133 171.108C493.133 173.182 494.836 174.861 496.935 174.861Z"
        fill="#438DBF"
      />
      <path
        d="M496.935 174.861H508.067C510.166 174.861 511.869 173.182 511.869 171.111C511.869 169.038 510.166 167.358 508.067 167.358H496.935C494.836 167.358 493.133 169.038 493.133 171.108C493.133 173.182 494.836 174.861 496.935 174.861Z"
        fill="url(#paint9_linear)"
      />
      <path
        d="M508.067 222.715H496.935C494.836 222.715 493.133 224.395 493.133 226.465C493.133 227.838 493.884 229.037 495 229.691C495.097 229.746 495.194 229.798 495.296 229.848C495.793 230.082 496.347 230.218 496.938 230.218H508.07C510.169 230.218 511.872 228.539 511.872 226.468C511.869 224.395 510.166 222.715 508.067 222.715Z"
        fill="#342ABC"
      />
      <path
        d="M508.067 222.715H496.935C494.836 222.715 493.133 224.395 493.133 226.465C493.133 227.838 493.884 229.037 495 229.691C495.097 229.746 495.194 229.798 495.296 229.848C495.793 230.082 496.347 230.218 496.938 230.218H508.07C510.169 230.218 511.872 228.539 511.872 226.468C511.869 224.395 510.166 222.715 508.067 222.715Z"
        fill="url(#paint10_linear)"
      />
      <path
        d="M519.194 185.933C521.293 185.933 522.996 184.254 522.996 182.183C522.996 180.112 521.293 178.433 519.194 178.433C517.095 178.433 515.393 180.112 515.393 182.183C515.393 184.254 517.095 185.933 519.194 185.933Z"
        fill="#57C6CE"
      />
      <path
        d="M519.194 185.933C521.293 185.933 522.996 184.254 522.996 182.183C522.996 180.112 521.293 178.433 519.194 178.433C517.095 178.433 515.393 180.112 515.393 182.183C515.393 184.254 517.095 185.933 519.194 185.933Z"
        fill="url(#paint11_linear)"
      />
      <path
        d="M520.677 200.868C520.563 200.821 520.448 200.778 520.328 200.74C520.09 200.668 519.841 200.616 519.585 200.59C519.456 200.578 519.327 200.569 519.198 200.569H508.065C505.966 200.569 504.264 202.249 504.264 204.32C504.264 206.39 505.966 208.07 508.065 208.07H519.198C519.33 208.07 519.459 208.064 519.585 208.05C521.502 207.859 522.999 206.26 522.999 204.317C522.999 202.77 522.042 201.435 520.677 200.868Z"
        fill="#50B3C8"
      />
      <path
        d="M520.677 200.868C520.563 200.821 520.448 200.778 520.328 200.74C520.09 200.668 519.841 200.616 519.585 200.59C519.456 200.578 519.327 200.569 519.198 200.569H508.065C505.966 200.569 504.264 202.249 504.264 204.32C504.264 206.39 505.966 208.07 508.065 208.07H519.198C519.33 208.07 519.459 208.064 519.585 208.05C521.502 207.859 522.999 206.26 522.999 204.317C522.999 202.77 522.042 201.435 520.677 200.868Z"
        fill="url(#paint12_linear)"
      />
      <path
        d="M519.194 211.643C517.095 211.643 515.393 213.323 515.393 215.393C515.393 217.464 517.095 219.144 519.194 219.144C521.293 219.144 522.996 217.464 522.996 215.393C522.996 213.323 521.296 211.643 519.194 211.643Z"
        fill="#3F83BD"
      />
      <path
        d="M519.194 211.643C517.095 211.643 515.393 213.323 515.393 215.393C515.393 217.464 517.095 219.144 519.194 219.144C521.293 219.144 522.996 217.464 522.996 215.393C522.996 213.323 521.296 211.643 519.194 211.643Z"
        fill="url(#paint13_linear)"
      />
    </g>
    <defs>
      <linearGradient
        id="paint0_linear"
        x1="-0.478513"
        y1="482"
        x2="215.243"
        y2="439.933"
        gradientUnits="userSpaceOnUse"
      >
        <stop stopColor="#56C6CD" />
        <stop offset="1" stopColor="#076186" stopOpacity="0" />
      </linearGradient>
      <linearGradient
        id="paint1_linear"
        x1="220.521"
        y1="91"
        x2="21.6088"
        y2="192.32"
        gradientUnits="userSpaceOnUse"
      >
        <stop stopColor="#AB4294" />
        <stop offset="1" stopColor="#AE2691" stopOpacity="0" />
      </linearGradient>
      <linearGradient
        id="paint2_linear"
        x1="320.608"
        y1="472.812"
        x2="508.395"
        y2="389.907"
        gradientUnits="userSpaceOnUse"
      >
        <stop stopColor="#1E769A" stopOpacity="0" />
        <stop offset="1" stopColor="#56C6CD" />
      </linearGradient>
      <linearGradient
        id="paint3_linear"
        x1="253.659"
        y1="274.194"
        x2="133.346"
        y2="381.662"
        gradientUnits="userSpaceOnUse"
      >
        <stop stopColor="#AE2691" stopOpacity="0" />
        <stop offset="1" stopColor="#AB4294" />
      </linearGradient>
      <linearGradient
        id="paint4_linear"
        x1="201.172"
        y1="325.534"
        x2="439.929"
        y2="101.609"
        gradientUnits="userSpaceOnUse"
      >
        <stop stopColor="#1E769A" stopOpacity="0" />
        <stop offset="1" stopColor="#56C6CD" />
      </linearGradient>
      <linearGradient
        id="paint5_linear"
        x1="129.021"
        y1="31.5"
        x2="-30.2558"
        y2="314.798"
        gradientUnits="userSpaceOnUse"
      >
        <stop stopColor="#AE2691" stopOpacity="0" />
        <stop offset="1" stopColor="#AB4294" />
      </linearGradient>
      <linearGradient
        id="paint6_linear"
        x1="489.601"
        y1="182.943"
        x2="482"
        y2="182.943"
        gradientUnits="userSpaceOnUse"
      >
        <stop stopColor="#7A95F9" />
        <stop offset="1" stopColor="#7A95F9" stopOpacity="0" />
      </linearGradient>
      <linearGradient
        id="paint7_linear"
        x1="500.725"
        y1="194.014"
        x2="482"
        y2="194.014"
        gradientUnits="userSpaceOnUse"
      >
        <stop stopColor="#986AF9" />
        <stop offset="1" stopColor="#986AF9" stopOpacity="0" />
      </linearGradient>
      <linearGradient
        id="paint8_linear"
        x1="489.601"
        y1="216.154"
        x2="482"
        y2="216.154"
        gradientUnits="userSpaceOnUse"
      >
        <stop stopColor="#DD7AF3" />
        <stop offset="1" stopColor="#DD7AF3" stopOpacity="0" />
      </linearGradient>
      <linearGradient
        id="paint9_linear"
        x1="511.861"
        y1="171.87"
        x2="493.133"
        y2="171.87"
        gradientUnits="userSpaceOnUse"
      >
        <stop stopColor="#98E8FB" />
        <stop offset="1" stopColor="#98E8FB" stopOpacity="0" />
      </linearGradient>
      <linearGradient
        id="paint10_linear"
        x1="511.864"
        y1="227.227"
        x2="493.133"
        y2="227.227"
        gradientUnits="userSpaceOnUse"
      >
        <stop stopColor="#7E6AFA" />
        <stop offset="1" stopColor="#7E6AFA" stopOpacity="0" />
      </linearGradient>
      <linearGradient
        id="paint11_linear"
        x1="522.993"
        y1="182.943"
        x2="515.393"
        y2="182.943"
        gradientUnits="userSpaceOnUse"
      >
        <stop stopColor="#B6FCFD" />
        <stop offset="1" stopColor="#B6FCFD" stopOpacity="0" />
      </linearGradient>
      <linearGradient
        id="paint12_linear"
        x1="522.992"
        y1="205.08"
        x2="504.264"
        y2="205.08"
        gradientUnits="userSpaceOnUse"
      >
        <stop stopColor="#ADF8FC" />
        <stop offset="1" stopColor="#ADF8FC" stopOpacity="0" />
      </linearGradient>
      <linearGradient
        id="paint13_linear"
        x1="522.993"
        y1="216.154"
        x2="515.393"
        y2="216.154"
        gradientUnits="userSpaceOnUse"
      >
        <stop stopColor="#92E2FB" />
        <stop offset="1" stopColor="#92E2FB" stopOpacity="0" />
      </linearGradient>
    </defs>
  </svg>
)
